<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Ad...</title>
    
    <!-- Step 1: Zaroori Libraries -->
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <link href="https://unpkg.com/videojs-contrib-ads/dist/videojs.ads.css" rel="stylesheet" />
    <link href="https://unpkg.com/videojs-ima/dist/videojs.ima.css" rel="stylesheet" />

    <style>
        /* Poori screen ko cover karo */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
        }
        /* Player ko poori screen do */
        #ad-player {
            width: 100%;
            height: 100%;
        }
        /* Backup message, agar kuch na chale */
        #fallback-message {
            display: none; /* Shuru me hide rakho */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: sans-serif;
            font-size: 1.2em;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- Video Player ka Element -->
    <video id="ad-player" class="video-js" playsinline></video>

    <!-- Backup Message -->
    <div id="fallback-message">
        <p>Loading your movie...</p>
    </div>

    <!-- Step 2: Zaroori Scripts -->
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <script src="https://unpkg.com/videojs-contrib-ads/dist/videojs.ads.min.js"></script>
    <script src="https://unpkg.com/videojs-ima/dist/videojs.ima.min.js"></script>

    <script>
        // Self-invoking function to avoid global scope issues
        (function() {
            const fallbackMessage = document.getElementById('fallback-message');
            const urlParams = new URLSearchParams(window.location.search);
            const movieUrl = urlParams.get('redirect');

            // Function to redirect
            const redirectToMovie = () => {
                if (movieUrl) {
                    window.location.href = movieUrl;
                } else {
                    fallbackMessage.style.display = 'block';
                    fallbackMessage.innerText = 'Error: Movie link not found.';
                }
            };

            // Agar movie link hi nahi hai, to aage mat badho
            if (!movieUrl) {
                redirectToMovie();
                return;
            }

            // Ad fail hone par 5 second ka wait
            const handleAdFailure = () => {
                fallbackMessage.style.display = 'block';
                setTimeout(redirectToMovie, 5000); // 5 second baad redirect
            };

            try {
                // Player ko initialize karo
                const player = videojs('ad-player', {
                    autoplay: true,
                    muted: true,
                    controls: false // Ad ke time control nahi chahiye
                });

                // Google ka Test Ad Link
                const adTagUrl = 'https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator=';

                // IMA plugin ko set karo
                player.ima({ adTagUrl: adTagUrl });

                // Events
                player.on('adsended', redirectToMovie);
                player.on(['adserror', 'adtimeout', 'nopreroll'], handleAdFailure);

            } catch (error) {
                console.error("Player initialization failed:", error);
                handleAdFailure(); // Agar player banane me hi error aa jaye
            }
        })();
    </script>

</body>
</html>

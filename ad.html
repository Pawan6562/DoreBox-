<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advertisement</title>
    
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <link href="https://unpkg.com/videojs-contrib-ads/dist/videojs.ads.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/videojs-ima/dist/videojs.ima.css" rel="stylesheet" type="text/css" />

    <style>
        body { margin: 0; background-color: #000; color: white; font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #ad-container { position: absolute; top:0; left:0; width: 100%; height: 100%; }
        .video-js { width: 100%; height: 100%; }
        #message-overlay { font-size: 1.2em; text-align: center; padding: 20px; z-index: 10; }
        #countdown { font-size: 1.5em; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

    <div id="ad-container">
        <video id="ad-player" class="video-js vjs-default-skin" playsinline></video>
    </div>
    
    <div id="message-overlay">
        <p>Advertisement</p>
        <p id="countdown">Your movie will start shortly...</p>
    </div>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <script src="https://unpkg.com/videojs-contrib-ads/dist/videojs.ads.min.js"></script>
    <script src="https://unpkg.com/videojs-ima/dist/videojs.ima.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const countdownElement = document.getElementById('countdown');
            const urlParams = new URLSearchParams(window.location.search);
            const movieUrl = urlParams.get('redirect');
            let adPlayed = false;

            const redirectToMovie = () => {
                if (movieUrl) {
                    window.location.href = movieUrl;
                } else {
                    countdownElement.textContent = 'Error: Movie link not found!';
                }
            };

            if (!movieUrl) {
                redirectToMovie();
                return;
            }

            // Minimum 7 second ka wait time
            const MIN_WAIT_TIME = 7000; // 7 seconds
            const startTime = Date.now();

            const finalRedirect = () => {
                const elapsedTime = Date.now() - startTime;
                const remainingTime = MIN_WAIT_TIME - elapsedTime;
                
                if (remainingTime > 0) {
                    setTimeout(redirectToMovie, remainingTime);
                } else {
                    redirectToMovie();
                }
            };

            const player = videojs('ad-player', { autoplay: true, muted: true, controls: false });
            player.ima({
                adTagUrl: 'https://altruistic-departure.com/d.mkFczddkGZNiv/ZVGnUJ/beRm/9_uVZSUllVk/PUT/YW2hMqD/E/5tMuzDkRt/NcjzYlwRM/TMkD0WMaAx'
            });

            player.on('adsended', () => {
                adPlayed = true;
                finalRedirect();
            });

            player.on(['adserror', 'adtimeout', 'nopreroll'], (event) => {
                console.error('Ad failed to load:', event.type);
                finalRedirect();
            });

            // Countdown timer UI
            let timeLeft = Math.ceil(MIN_WAIT_TIME / 1000);
            countdownElement.textContent = `Redirecting in ${timeLeft}...`;
            const interval = setInterval(() => {
                timeLeft--;
                if (timeLeft > 0) {
                    countdownElement.textContent = `Redirecting in ${timeLeft}...`;
                } else {
                    clearInterval(interval);
                }
            }, 1000);

        });
    </script>
</body>
</html>
